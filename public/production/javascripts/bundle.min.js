function checkAndUpdateFBURL(){"#_=_"==window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname))}var app=angular.module("App",["ngRoute","ngMaterial","ngMessages","ngAnimate","ngSanitize","templates"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$compileProvider",function(e,t,n,r){e.when("/page/:page",{templateUrl:function(e){return"/partials/"+e.page},controller:"DiscussionCtrl",controllerAs:"discussionCtrl"}).when("/explore",{templateUrl:"/views/explore.ejs",controller:"ExploreCtrl",controllerAs:"exploreCtrl"}).when("/",{templateUrl:"/views/home.ejs",controller:["$window",function(e){e.document.title="Nemoo"}]}),t.html5Mode({enabled:!0,requireBase:!1}),r.debugInfoEnabled(!1),checkAndUpdateFBURL();var o=n.extendPalette("indigo",{contrastDefaultColor:"light",contrastDarkColors:["50"],50:"ffffff"});n.definePalette("custom",o),n.theme("default").primaryPalette("custom",{default:"500","hue-1":"50"}).accentPalette("amber")}]);var app=angular.module("App");app.controller("AuthenticationCtrl",["$http","optimizationService",function(e,t){var n=this;this.data={email:"",password:"",password2:""},this.submit=function(r){e.post(r,n.data).then(function(e){e.data.redirect?t.refreshPage():n.message=data.message})}}]),app.directive("nemooLogin",function(){return{restrict:"E",templateUrl:"/views/login.ejs",controller:"AuthenticationCtrl",controllerAs:"loginCtrl"}}),app.directive("nemooSignUp",function(){return{restrict:"E",templateUrl:"/views/signup.ejs",controller:"AuthenticationCtrl",controllerAs:"signUpCtrl"}});var app=angular.module("App"),options=["Advice","Animals","Automotive","Books","Business","Career","Celebrity","Debate","Entertainment","Environment","Family","Fashion","Finance","Food","Gaming","Health","Hobbies","Humor","Lifestyle","Movies","Music","News","Religion","Science","Sports","Technology","Television","Travel","Weather"];app.controller("DiscussionDialogCtrl",["$mdDialog","$http","$scope","user","toastManager","optimizationService",function(e,t,n,r,o,i){var a=this;this.options=options,this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.data={category:"",name:"",description:"",user:r},this.submit=function(e){var n=a.cleanData(a.data);t.post(e,n).then(function(e){var t=e.data.redirect;t?(i.softRedirect(t),a.cancel(),o.showSimpleWithAction("Successfully create discussion!",3e3)):a.message=data.message})},this.cleanData=function(e){return{category:e.category,name:e.name.toLowerCase().split(" ").join("-"),description:e.description,user:e.user}}}]);var app=angular.module("App"),MAX_QUEUE_LENGTH=25;app.controller("DiscussionCtrl",["$mdMedia","$routeParams","$timeout","$scope","$templateCache","stateService","$mdDialog","$http","toastManager","$window",function(e,t,n,r,o,i,a,l,s,c){var u=this,d=t.page;o.remove("/partials/"+d),this.init=function(e,t){c.document.title="Nemoo - "+e,i._state.page=d,i._state.pageName=e,this.addableToFavorites=i._state.loggedIn&&i._state.user.favorites.indexOf(e)===-1,this.prerenderedLen=t,this.data=[],i._state.socket.on(i._state.page+" message received",this.receiveMessage)},this.receiveMessage=function(e,t,n,o){var i=u.data.length,a={displayName:t.displayName,profilePic:t.profilePic,backgroundColor:t.backgroundColor,created:t.created,message:e};0===u.prerenderedLen?u.data.shift():0===i?u.lastPrerenderedEl.append($("<md-divider md-inset></md-divider>")):u.prerenderedLen+i>=MAX_QUEUE_LENGTH&&(u.$el.find("md-list-item").first().remove(),u.prerenderedLen--),o&&u.youtubeHandler(a),u.data.push(a),n||r.$apply()},this.addToFavorite=function(e){var t=i._state.pageName,n=a.confirm().title("Add "+t+" to Favorites").htmlContent("Confirm to display it under the Favorites tab on the sidebar. <br>To remove it, simply visit your settings under the General tab.").targetEvent(e).ok("Confirm").cancel("Cancel");a.show(n).then(function(){l.post("/addToFavorite",{pageName:t}).then(function(){i._state.user.favorites.push(t),s.showSimpleWithAction("Successfully favorited "+t,3e3),u.addableToFavorites=!1})},function(){s.showSimpleWithAction("Error could not favorite",3e3)})},this.youtubeHandler=function(e){var t=$(e.message),r=this.getUUID();e.message="",e.class=["discussion-youtube",r],n(function(){$(".discussion-youtube."+r).append(t)})},this.getUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},this.quickMessageHandler=function(e,t,n){var r={displayName:t.displayName,profilePic:t.profilePic,backgroundColor:t.backgroundColor,created:Date.now()};this.receiveMessage(e,r,!0,n)},n(function(){u.$el=$("#scrollable-container-list"),u.lastPrerenderedEl=u.$el.find("md-list-item").last(),u.lastPrerenderedEl.find("md-divider").remove()});var p=r.$on("$destroy",function(){u.$el=null,u.lastPrerenderedEl=null,u.data=null,i._state.socket.removeListener(i._state.page+" message received",u.receiveMessage),p()})}]),app.animation(".animate-message",["animationService",function(e){var t=function(){var e=document.getElementById("scrollable-container");$(e).scrollTop(e.scrollHeight)};return{enter:function(n){e.animateCss(n,"bounce"),t()}}}]);var app=angular.module("App");app.controller("ExploreCtrl",["$http","$window","$scope","$timeout","optimizationService",function(e,t,n,r,o){var i=this;t.document.title="Nemoo - Explore",i.loaded=-1,e.get("/googleTrends").then(function(e){i.items=e.data,i.loaded=1},function(){i.items=[],i.loaded=1});var a=n.$watch(function(){return $("#explore-page").width()*i.loaded},function(e,t){r(function(){if(i.items&&0!==i.items.length){var e,t=$("#explore-page");t.find(".dummy-explore").remove();var n=_.groupBy(t.children(),function(e){return e.offsetTop}),r=Object.keys(n).length;if(!(r<2)){var o=0;for(prevHeight=t[0].clientHeight,currHeight=prevHeight;currHeight===prevHeight;)e=$("<div>",{class:"explore-tile dummy-explore",style:"visibility: hidden"}),t.append(e),currHeight=t[0].clientHeight,o++;t.children().last().remove()}}})}),l=n.$on("$destroy",function(){a(),l()});this.handleClick=function(t,n){var r=$(n.target).parent().find(".explore-description").text().trim(),a=i.cleanData(t,r);e.post("/createDiscussion",a).then(function(e){o.softRedirect("/page/"+a.name)})},this.cleanData=function(e,t){var n={displayName:"Admin",profilePic:"/images/user/tabby.jpg"};return{category:window.nemooCategory||"Recent",name:e.name.toLowerCase().split(" ").join("-"),description:t,user:n}}}]),function(e,t){"function"==typeof define&&define.amd?define(["exports"],function(n){t(e,n)}):"undefined"!=typeof exports?t(e,exports):t(e,e.fd=e.fd||{})}(this,function(t,n){n.randomID=function(e){return(e||"fd")+"_"+(1e4*Math.random()).toFixed()},n.uniqueID=function(e){do var t=n.randomID(e);while(n.byID(t));return t},n.byID=function(e){return n.isTag(e)?e:document.getElementById(e)},n.isTag=function(e,t){return"object"==typeof e&&e&&1==e.nodeType&&(!t||e.tagName.toUpperCase()==t.toUpperCase())},n.newXHR=function(){try{return new XMLHttpRequest}catch(n){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}throw"Cannot create XMLHttpRequest."},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.toArray=function(e,t){return null===e||"undefined"==typeof e?[]:(!n.isArray(e)&&("object"!=typeof e||!("callee"in e))&&(e=[e]),Array.prototype.slice.call(e,t||0))},n.addEvent=function(e,t,n){return e&&t&&n&&(e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)),e},n.stopEvent=function(e){return e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e},n.setClass=function(e,t,r){return(e=n.byID(e))&&null!=t&&("undefined"==typeof r||r?n.hasClass(e,t)||(e.className+=" "+t):e.className=e.className.replace(n.classRegExp(t)," ")),e},n.hasClass=function(e,t){return n.classRegExp(t).test((n.byID(e)||{}).className)},n.classRegExp=function(e){return""==e||"object"==typeof e?/$o_O/:new RegExp("(^|\\s+)"+e+"(\\s+|$)","gi")},n.extend=function(e,t,n){e=e||{},t=t||{};for(var r in t)(n||"undefined"==typeof e[r])&&(e[r]=t[r]);return e},n.callAll=function(e,t,r){var o;if(t=n.toArray(t),"function"==typeof e&&(e=[e]),n.isArray(e))for(var i=0;i<e.length&&("function"!=typeof e[i]||(o=e[i].apply(r||this,t),null==o));i++);else if(e)throw"FileDrop event list must be either an Array, Function, undefined or null but "+typeof e+" was given.";return o},n.callAllOfObject=function(e,t,r){if(n.logging&&n.hasConsole){var o=e.events[t]?e.events[t].length||0:0;console.info("FileDrop "+t+" event ("+o+") args:"),console.dir([r])}var i=[n.onObjectCall].concat(e.events.any),a=n.callAll(i,[t].concat(n.toArray(r)),e);return null!=a?a:n.callAll(e.events[t],r,e)},n.appendEventsToObject=function(e,t){if(n.addEventsToObject(this,!1,arguments))return this;switch(arguments.length){case 0:return n.extend({},this.events);case 1:if(null===e)return this.events={},this;if(n.isArray(e)){for(var r={},o=0;o<e.length;o++)r[e[o]]=n.toArray(this.events[e[o]]);return r}if("function"==typeof e)return n.funcNS(e);if("string"==typeof e)return n.toArray(this.events[e]);case 2:if(e=n.toArray(e),null===t){for(var o=0;o<e.length;o++){var i=n.splitNS(e[o]);if(i[0])if(i[1]){if(this.events[i[0]])for(var a=this.events[i[0]].length-1;a>=0;a--)n.funcNS(this.events[i[0]][a])==i[1]&&this.events[i[0]].splice(a,1)}else this.events[i[0]]=[];else for(var l in this.events)arguments.callee.call(this,[l+":"+i[1]],null)}return this}}throw"Bad parameters for FileDrop event()."},n.previewToObject=function(e,t){if(n.addEventsToObject(this,!0,arguments))return this;throw"Bad parameters for FileDrop preview()."},n.addEventsToObject=function(e,t,r){var o=r[0],i=r[1];switch(r.length){case 1:if(o&&"object"==typeof o&&!n.isArray(o)){for(var a in o)arguments.callee(e,t,[a,o[a]]);return!0}case 2:if("function"==typeof i||n.isArray(i)){o=n.toArray(o),i=n.toArray(i);for(var l=t?"unshift":"push",s=0;s<o.length;s++){for(var c=n.splitNS(o[s]),u=0;u<i.length;u++)n.funcNS(i[u],c[1]);e.events[c[0]]=e.events[c[0]]||[],e.events[c[0]][l].apply(e.events[c[0]],i)}return!0}}},n.funcNS=function(e,t){return"function"!=typeof e?e:1==arguments.length?(e[n.nsProp]||"").toString():(e[n.nsProp]=(t||"").toString(),e)},n.splitNS=function(e){return(e||"").match(/^([^:]*):?(.*)$/).slice(1)},n.extend(n,{logging:!0,hasConsole:"console"in window&&console.log&&console.dir,onObjectCall:null,all:[],isIE6:!1,isIE9:!1,isChrome:(navigator.vendor||"").indexOf("Google")!=-1,nsProp:"_fdns"}),n.DropHandle=function(e,t){var r=this;if(r.el=e=n.byID(e),!e)throw"Cannot locate DOM node given to new FileDrop class.";r.opt={zoneClass:"fd-zone",inputClass:"fd-file",iframe:{url:"",callbackParam:"fd-callback",fileParam:"fd-file"},input:null,recreateInput:!0,fullDocDragDetect:!1,multiple:!1,dropEffect:"copy"},n.all.push(r),r.filedrop=null;var o=r.opt.iframe;n.extend(r.opt,t,!0),n.extend(r.opt.iframe,o),n.isChrome&&(r.opt.fullDocDragDetect=!0),r.events={any:[],dragEnter:[],dragLeave:[],dragOver:[],dragEnd:[],dragExit:[],upload:[],uploadElsewhere:[],inputSetup:[],iframeSetup:[],iframeDone:[]},r.on=r.events,r.zone=r.el,r.hook=function(e){0!=r.opt.input&&(r.opt.input=r.opt.input||r.prepareInput(e),r.opt.input&&n.callAllOfObject(r,"inputSetup",r.opt.input)),r.hookDragOn(e),r.hookDropOn(e)},r.hookDragOn=function(e){r.opt.fullDocDragDetect?(r.delegate(document.body,"dragEnter"),n.addEvent(document,"dragleave",function(e){(0==e.clientX&&0==e.clientY||n.isTag(e.relatedTarget,"html"))&&(n.stopEvent(e),n.callAllOfObject(r,"dragLeave",e))})):(r.delegate(e,"dragEnter"),r.delegate(e,"dragLeave")),r.delegate(e,"dragOver"),r.delegate(e,"dragEnd"),r.delegate(e,"dragExit")},r.hookDropOn=function(e){n.isIE9||r.delegate(e,"drop","upload")},r.delegate=function(e,t,o){n.addEvent(e,t.toLowerCase(),function(e){n.stopEvent(e),n.callAllOfObject(r,o||t,e)})},r.prepareInput=function(e){var t=r.findInputRecursive(e)||r.createInputAt(e);if(t){for(var o=t.parentNode;o&&!n.isTag(o,"form");)o=o.parentNode;if(!o)throw"FileDrop file input has no parent form element.";var i=o?o.getAttribute("target"):"";if(i&&n.isTag(n.byID(i),"iframe"))return{file:t,form:o}}return!1},r.findInputRecursive=function(e){for(var t=0;t<e.childNodes.length;t++){var o=e.childNodes[t];if(n.isTag(o,"input")&&"file"==o.getAttribute("type")&&n.hasClass(o,r.opt.inputClass))return o;if(o=arguments.callee(o))return o}},r.createInputAt=function(e){do var t=n.randomID();while(n.byID(t));var o=document.createElement("div");o.innerHTML='<iframe src="javascript:false" name="'+t+'"></iframe><form method="post" enctype="multipart/form-data"><input type="hidden" name="'+r.opt.iframe.callbackParam+'" /><input type="file" name="'+r.opt.iframe.fileParam+'" /></form>',o.firstChild.setAttribute("id",t),o.firstChild.style.display="none",o.lastChild.setAttribute("target",t);for(var i=e.firstChild;i&&(!n.isTag(i)||n.isTag(i,"legend"));)i=i.nextSibling;return i?e.insertBefore(o,i):e.appendChild(o),o.lastChild.lastChild},r.abortIFrame=function(){if(r.opt.input.form){var e=n.byID(r.opt.input.form.getAttribute("target"));e&&e.setAttribute("src","javascript:false")}},r.sendViaIFrame=function(e){e=e||r.opt.iframe.url;var t=(r.opt.input||{}).form;if(e&&t){do var o=n.randomID();while(o in window);window[o]=function(t){"object"!=typeof t&&(t={response:t,responseXML:"",responseText:(t||"").toString(),readyState:4,status:200,statusText:"OK",getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},setRequestHeader:function(){return this},statusCode:function(){return this},abort:function(){return this}}),n.extend(t,{iframe:!0,url:e}),n.callAllOfObject(r,"iframeDone",t)};for(var i=t.firstChild;i&&(!n.isTag(i,"input")||i.name!=r.opt.iframe.callbackParam);)i=i.nextSibling;return i?i.value=o:e=e.replace(/[?&]+$/,"")+(e.indexOf("?")==-1?"?":"&")+r.opt.iframe.callbackParam+"="+o,t.setAttribute("action",e),n.callAllOfObject(r,"iframeSetup",t),t.submit(),setTimeout(r.resetForm,300),!0}},r.resetForm=function(){var e=r.opt.input&&r.opt.input.file;if(e&&(e.value="",r.opt.recreateInput)){var t=r.opt.input.file=e.cloneNode(!0);e.parentNode.replaceChild(t,e),n.callAllOfObject(r,"inputSetup",[r.opt.input,e])}},r.multiple=function(e){return r.opt.input&&"undefined"!=typeof e&&(e?r.opt.input.file.setAttribute("multiple","multiple"):r.opt.input.file.removeAttribute("multiple")),r.opt.input&&!!r.opt.input.file.getAttribute("multiple")},r.event=function(e,t){return n.appendEventsToObject.apply(r,arguments)},r.preview=function(e,t){return n.previewToObject.apply(r,arguments)},r.onInputSetup=function(t,o){o?(t.file.clearAttributes&&t.file.clearAttributes(),t.file.mergeAttributes&&t.file.mergeAttributes(o)):r.multiple(r.opt.multiple),n.setClass(t.file,r.opt.inputClass),r.delegate(t.file,"change","upload");var i=t.file.parentNode;if(i&&i.style.display.match(/^(static)?$/)&&(i.style.position="relative"),n.isTag(e,"fieldset")){var a=document.createElement("div");a.style.position="relative",a.style.overflow="hidden",e.parentNode.insertBefore(a,e),a.appendChild(e)}},r.onDragOver=function(e){n.stopEvent(e),e.dataTransfer&&(e.dataTransfer.dropEffect=r.opt.dropEffect)},r.onUpload=function(){for(var e=0;e<n.all.length;e++)n.all[e]!==r&&n.all[e].events&&n.callAllOfObject(n.all[e],"uploadElsewhere",r)},r.event({inputSetup:r.onInputSetup,dragOver:r.onDragOver,upload:r.onUpload}),n.setClass(e,r.opt.zoneClass),r.hook(e)},n.FileDrop=function(e,t){function r(t){return function(){n.setClass(e,o.opt.dragOverClass,t)}}var o=this;e=n.byID(e),o.handle=new n.DropHandle(e,t),o.handle.filedrop=o,n.extend(o.handle.opt,{dragOverClass:"over"}),n.extend(o.handle.opt.iframe,{force:!1}),n.extend(o.handle.events,{send:[],fileSetup:[]}),o.onUpload=function(e){var t=!o.opt.iframe.force&&o.eventFiles(e,!0);t?t.length>0&&n.callAllOfObject(o,"send",[t]):!o.handle.sendViaIFrame()&&n.hasConsole&&console.warn("FileDrop fallback upload triggered but iframe options were not configured - doing nothing.")},o.eventFiles=function(e,t){var r=new n.FileList(e);if(e.dataTransfer&&(e.dataTransfer.length||e.dataTransfer.files))var i=e.dataTransfer;else var i=e.target&&e.target.files||e.srcElement&&e.srcElement.files;if(i){var a=i.items||[];i.files&&(i=i.files);for(var l={},s=0;s<i.length;s++){var c=new n.File(i[s]);l[c.name]&&"image.jpg"!=c.name||(l[c.name]=!0,c.setNativeEntry(a[s]),n.callAllOfObject(o,"fileSetup",c),(c.size>0||c.nativeEntry)&&r.push(c))}}else t&&(r=!1);return r},n.extend(o,o.handle),o.event({upload:o.onUpload,send:o.resetForm,dragEnter:r(!0),dragLeave:r(!1),uploadElsewhere:r(!1)}),o.preview({upload:r(!1)})},n.FileList=function(e){var t=this;t.dropEffect=e&&e.dropEffect||"",t.length=0,e=null,t.push=function(e){return t[t.length++]=e,t},t.pop=function(){if(t.length>0){var e=t.last();return delete t[--t.length],e}},t.first=function(){return t[0]},t.last=function(){return t[t.length-1]},t.remove=function(e){for(;e<t.length-1;e++)t[e]=t[e+1];return se.f.pop(),t},t.clear=function(){for(var e=0;e<t.length;e++)delete t[e];return t.length=0,t},t.reverse=function(){for(var e=0;e<Math.floor(t.length/2);e++)t[e]=t[t.length-e-1];return t},t.concat=function(e){for(var r=new n.FileList,o=0;o<t.length;o++)r[o]=t[o];for(var o=0;e&&o<e.length;o++)r[t.length+o+1]=e[o];return r.length=t.length+(e||[]).length,t},t.sort=function(e,n){for(var r=0;r<t.length;r++)for(var o=0;o<t.length;o++)if(e.call(n||this,t[r],t[o],r,o)<0){var i=t[r];t[r]=t[o],t[o]=i}return t},t.sortBy=function(e,n){for(var r=[],o=0;o<t.length;o++)r.push([o,e.call(n||this,t[o],o)]);r.sort(function(e,t){return e[1]>t[1]?1:e[1]<t[1]?-1:0});for(var o=0;o<r.length;o++)t[o]=r[o][0];return t},t.find=function(e,n){for(var r=0;r<t.length;r++){var o=e.call(n||this,t[r],r);if(null!=o)return t[r]}},t.each=function(e,n){return t.find(function(){e.apply(this,arguments)},n),t},t.invoke=function(e,t){var r=n.toArray(arguments,1);return this.each(function(t){t[e].apply(t,r)})},t.abort=function(){return this.invoke("abort")},t.findCompare=function(e,n){var r,o,i=null;return t.each(function(t){(null==i||i<(o=e.call(n,r)))&&(r=t)},n),r},t.filter=function(e,r){var o=new n.FileList;return t.each(function(t){e.apply(this,arguments)&&o.push(t)},r),o},t.largest=function(){return t.findCompare(function(e){return e.size})},t.smallest=function(){return t.findCompare(function(e){return-e.size})},t.oldest=function(){return t.findCompare(function(e){return-e.modDate.getTime()})},t.newest=function(){return t.findCompare(function(e){return e.modDate})},t.ofType=function(e){return e+=e.indexOf("/")==-1?"/":"$",e=new RegExp("^"+e,"i"),t.filter(function(t){return e.test(t.type)})},t.images=function(){return t.ofType("image")},t.named=function(e){return"string"==typeof e?t.find(function(t){return t.name==e}):t.filter(function(t){return e.test(t.name)})}},n.FileList.prototype.length=0,n.FileList.prototype.splice=Array.prototype.splice,n.File=function(t){var r=this;r.nativeFile=t,r.nativeEntry=null,r.name=t.fileName||t.name||"",r.size=t.fileSize||t.size||0,r.type=r.mime=t.fileType||t.type||"",r.modDate=t.lastModifiedDate||new Date,r.xhr=null,r.opt={extraHeaders:!0,xRequestedWith:!0,method:"POST"},r.events={any:[],xhrSetup:[],xhrSend:[],progress:[],done:[],error:[]},r.events.sendXHR=r.events.xhrSend,r.abort=function(){return r.xhr&&r.xhr.abort&&r.xhr.abort(),r},r.sendTo=function(e,t){if(t=n.extend(t,r.opt),t.url=e,r.size)if(window.FileReader){var o=new FileReader;o.onload=function(e){r.sendDataReadyTo(t,e)},o.onerror=function(e){n.callAllOfObject(r,"error",[e])},o.readAsArrayBuffer(r.nativeFile)}else r.sendDataReadyTo(t);else n.hasConsole&&console.warn("Trying to send an empty FileDrop.File.");return r},r.sendDataReadyTo=function(e,t){if(r.abort(),r.xhr=n.newXHR(),r.hookXHR(r.xhr),r.xhr.open(e.method,e.url,!0),r.xhr.overrideMimeType&&r.xhr.overrideMimeType("application/octet-stream"),r.xhr.setRequestHeader("Content-Type","application/octet-stream"),e.extraHeaders){r.xhr.setRequestHeader("X-File-Name",encodeURIComponent(r.name)),r.xhr.setRequestHeader("X-File-Size",r.size),r.xhr.setRequestHeader("X-File-Type",r.type),r.xhr.setRequestHeader("X-File-Date",r.modDate.toGMTString());var o=e.xRequestedWith;if(o===!0){var i=window.FileReader?"FileAPI":"Webkit";o="FileDrop-XHR-"+i}o&&r.xhr.setRequestHeader("X-Requested-With",o)}n.callAllOfObject(r,"xhrSetup",[r.xhr,e]);var a=t&&t.target&&t.target.result?t.target.result:r.nativeFile;return n.callAllOfObject(r,"xhrSend",[r.xhr,a,e]),r.xhr},r.hookXHR=function(e){var t=e.upload||e;e.onreadystatechange=function(t){if(4==e.readyState){try{var o=200==e.status?"done":"error"}catch(e){var o="error"}var i="error"==o?[t,e]:[e,t];n.callAllOfObject(r,o,i)}},t.onprogress=function(t){var o=t.lengthComputable?t.loaded:null;n.callAllOfObject(r,"progress",[o,t.total||null,e,t])}},r.readData=function(e,t,n){return r.read({onDone:e,onError:t,func:n})},r.readDataURL=function(e,t){return r.readData(e,t||!1,"uri")},r.readDataURI=r.readDataURL,r.read=function(t){function o(e,n){"object"==typeof n||(n.message=n),n.fdError=e,t.onError!==!1&&(t.onError||t.onDone).apply(this,arguments)}if(n.extend(t,{onDone:new Function,onError:null,blob:r.nativeFile,func:"",start:0,end:null,mime:""}),!window.FileReader)return o("support",e);(t.start>0||null!=t.end&&t.end)&&(t.blob.slice?(null==t.end&&(t.end=t.blob.size||t.blob.fileSize),t.blob=t.blob.slice(t.start,t.end,t.mime)):n.hasConsole&&console.warn("File Blob/slice() are unsupported - operating on entire File."));var i=new FileReader;i.onerror=function(e){o("read",e)},i.onload=function(e){e.target&&e.target.result?("readAsBinaryString"==t.func&&(e.target.result=String.fromCharCode.apply(null,new Uint8Array(e.target.result))),t.onDone(e.target.result)):i.onerror(e)};var a=t.func;if(n.isArray(a)){var l=a[0];return a[0]=t.blob,i[l].apply(i,a)}if(a&&"bin"!=a){if("url"==a||"uri"==a||"src"==a)a="readAsDataURL";else if("array"==a)a="readAsArrayBuffer";else if("text"==a)a="readAsText";else if("read"!=a.substr(0,4))return i.readAsText(t.blob,a)}else a="readAsBinaryString";return"readAsBinaryString"==a&&(a="readAsArrayBuffer"),i[a](t.blob)},r.listEntries=function(e,t){function o(t){l-=t,0==l&&e&&(e(a),e=null)}if(r.nativeEntry&&r.nativeEntry.isDirectory){t=t||new Function;var i=r.nativeEntry.createReader(),a=new n.FileList,l=0;return i.readEntries(function(e){for(var r=0;r<e.length;r++){var s=e[r];s.file?(l++,s.file(function(e){var t=new n.File(e);t.setNativeEntry(s),a.push(t),o(1)},function(){a.push(n.File.fromEntry(s)),o(1),t.apply(this,arguments)})):a.push(n.File.fromEntry(s))}r?i.readEntries(arguments.callee,t):o(0)},t),!0}},r.setNativeEntry=function(e){r.nativeEntry=e&&e.webkitGetAsEntry&&e.webkitGetAsEntry()},r.event=function(e,t){return n.appendEventsToObject.apply(r,arguments)},r.preview=function(e,t){return n.previewToObject.apply(r,arguments)},r.onXhrSend=function(e,t){e.send(t)},r.event({xhrSend:r.onXhrSend})},n.File.fromEntry=function(e){var t=new n.File(e);return t.setNativeEntry(e),t.nativeFile=null,t},n.jQuery=function(e){if(e=e||jQuery||window.jQuery,!e)throw"No window.jQuery object to integrate FileDrop into.";e.fn.filedrop=function(t){function r(e,t){return function(r){var i=(t||[]).concat(n.toArray(arguments,1));return o.triggerHandler((e+r).toLowerCase(),i)}}var o=this,i=this.data("filedrop");if("string"==typeof t)if(i){if("undefined"!=typeof i[t]){var a=i[t];return"function"==typeof a?a.apply(i,n.toArray(arguments,1)):a}e.error("There's no method or property FileDrop."+t+".")}else e.error("$.filedrop('comment') needs an initialized FilrDrop on this element.");else if(t&&"object"!=typeof t)e.error("Invalid $.filedrop() parameter - expected nothing (creates new zone), a string (property to access) or an object (custom zone options).");else if(i){if(!t)return i;n.extend(i.opt,t,!0)}else{var l=new FileDrop(this[0],t);l.$el=e(this),this.first().data("filedrop",l),l.event("any",r("fd")),l.on.fileSetup.push(function(e){e.event("any",r("file",[e]))})}return o}},t.FileDrop=n.FileDrop}),function(e,t,n,r,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=r,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-84261333-1","auto"),ga("send","pageview");var app=angular.module("App");app.controller("HeaderCtrl",["$scope","$mdSidenav","$mdMedia","$mdDialog","optimizationService","stateService","$http",function(e,t,n,r,o,i,a){var l=this;e.$watch(function(){return n("gt-sm")},function(e){l.open=e});this.togglePanel=function(){var e=t("left"),r=n("gt-sm");r?l.open=!l.open:(e.isOpen()||($("#message-input-box").blur(),window.getSelection().removeAllRanges()),e.toggle())},this.softRedirect=o.softRedirect,this.state=i._state,this.logout=function(){a.get("/logout").then(function(e){e.data.redirect&&o.refreshPage()})},this.showTabDialog=function(e,t){r.show({controller:["$mdDialog","optimizationService",function(e,n){this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.redirect=n.hardRedirect,this.selected=t}],controllerAs:"tabDlgCtrl",templateUrl:"/views/loginDialog.ejs",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.directive("nemooHeader",function(){return{restrict:"E",templateUrl:"/views/header.ejs",controller:"HeaderCtrl",controllerAs:"header"}});var app=angular.module("App");app.controller("MainCtrl",["stateService","$http",function(e,t){window.fd.logging=!1,this.init=e.initialize,t.post("/setTimezone",{offset:(new Date).getTimezoneOffset()})}]);var app=angular.module("App");app.controller("AdditionalOptionsDropdownCtrl",["$scope",function(e){e.ddSelectOptions=[{text:"Upload Images or Gifs",pageKey:"images",divider:!1,href:!1},{text:"Emoticon (People)",pageKey:"people",divider:!1,href:!1},{text:"Emoticon (Nature)",pageKey:"nature",divider:!1,href:!1},{text:"Emoticon (Object)",pageKey:"object",divider:!1,href:!1},{text:"Emoticon (Places)",pageKey:"places",divider:!1,href:!1},{text:"Emoticon (Symbol)",pageKey:"symbol",divider:!1,href:!1}],e.ddSelectSelected={text:"Emoticon (People)",pageKey:"people",divider:!1,href:!1},e.selectHandler=function(t){e.$parent.handlePageChange(t)}}]),app.directive("nemooAdditionalOptionsDropdown",function(){return{restrict:"E",scope:!0,templateUrl:"/views/additionalOptionsDropdown.ejs",controller:"AdditionalOptionsDropdownCtrl"}});var app=angular.module("App");app.directive("dropdownSelect",[function(){return{restrict:"A",replace:!0,scope:{dropdownSelect:"=",dropdownModel:"=",dropdownItemLabel:"@",dropdownOnchange:"&",dropdownDisabled:"="},controller:["$scope","$timeout",function(e,t){var n=this;e.labelField=e.dropdownItemLabel||"text",e.disabled=e.dropdownDisabled||!1,this.select=function(t){angular.equals(t,e.dropdownModel)||(e.dropdownModel=t),e.dropdownOnchange({selected:t}),n.$el.removeClass("active")},e.toggleDropDown=function(t){t.stopPropagation(),t.preventDefault(),e.dropdownDisabled||n.$el.toggleClass("active")},t(function(){n.$el=angular.element(document.getElementById("dropdown-custom-angular"))}),e.$on("$destroy",function(){n.$el=null})}],templateUrl:"/views/dropdownSelect.ejs"}}]),app.directive("dropdownSelectItem",[function(){return{require:"^dropdownSelect",replace:!0,scope:{dropdownItemLabel:"=",dropdownSelectItem:"="},link:function(e,t,n,r){e.selectItem=function(t){t.stopPropagation(),t.preventDefault(),e.dropdownSelectItem.href||r.select(e.dropdownSelectItem)}},templateUrl:"/views/dropdownSelectItem.ejs"}}]);var app=angular.module("App");app.controller("MessageAdditionalOptionsCtrl",["$scope","$timeout","$templateCache","$mdMedia","optimizationService","$http","stateService","toastManager","animationService",function(e,t,n,r,o,i,a,l,s){var c=this;this.pageKey="people";var u=e.$watch(function(){return r("gt-xs")},function(e){c.isLarge=e});this.onShowHandler=function(e){if(!c.isLarge){var t=$(window).width(),n=(t-278)/2,r=c.$el.offset().left+c.$el.width()/2-n;e.css("left",n),e.find(".webui-arrow").css("left",r)}},this.addEmoji=function(t){var n=$(t.target),r="SPAN"===n.prop("tagName")?n:n.find("span"),o=r.attr("class");s.animateCss(r,"rubberBand"),e.$parent.emoticonHandler(o),t.preventDefault()},this.beforeSend=!1,this.uri=null,this.fileInput=$("#zthumbs-input"),this.zone=new FileDrop("zthumbs",{input:!1}),this.zone.event("upload",function(e){var t=c.zone.eventFiles(e).images(),n=t[0];$(c.zone.el).find("img").remove(),"undefined"==typeof n?l.showSimpleWithAction("Invalid file type (requires jpeg, png, gif, etc.)",3e3):c.previewImage(n)}),this.previewImage=function(t){var n=document.getElementById("zthumbs-loader");n.style.display="block",t.readDataURI(function(t){n.style.display="none";var r=new Image;r.src=t,c.zone.el.appendChild(r),c.uri=t,c.beforeSend=!0,e.$apply()})},this.chooseImage=function(e){e.stopPropagation(),e.preventDefault(),this.beforeSend||(this.fileInput[0].value=null,this.fileInput.trigger("click"))},this.fileInput.on("change",function(){var e=c.fileInput[0].files,t=new fd.File(e[0]);t.mime.indexOf("image")===-1?l.showSimpleWithAction("Invalid file type (requires jpeg, png, gif, etc.)",3e3):c.previewImage(t)}),this.submitFile=function(e){this.removeFile(e),this.uploadImage()},this.uploadImage=function(){i.post("/uploadTempImage",{uri:this.uri,page:a._state.page}).then(function(t){var n=t.data.url;n?e.$parent.imageHandler(n):l.showSimpleWithAction("Error image upload failed",3e3)},function(e){l.showSimpleWithAction("Error image upload failed "+e.statusText,3e3)})},this.removeFile=function(e){e.stopPropagation(),e.preventDefault(),this.beforeSend=!1,$(this.zone.el).find("img").remove()},e.handlePageChange=function(e){c.pageKey=e.pageKey},t(function(){c.$el=$("#message-additional-button > .material-icons"),o.bindBodyBackDrop(),o.bindFocusHandler(),o.attachUIPopover(c.onShowHandler),c.showMenu=o.handleMenuClick});var d=e.$on("$destroy",function(){var e=["dragEnter","dragLeave","dragOver","upload","uploadElsewhere","inputSetup","send"];_.each(e,function(e){c.zone.event(e,null)}),c.fileInput.off("change"),c.$el=null,c.fileInput=null,c.zone=null,c.uri=null,u(),d()})}]),app.directive("nemooMessageAdditionalOptions",function(){return{restrict:"E",scope:{},templateUrl:"/views/messageAdditionalOptions.ejs",controller:"MessageAdditionalOptionsCtrl",controllerAs:"messageAddCtrl"}});var app=angular.module("App");app.controller("MessageInputCtrl",["$timeout","$scope","$mdMedia","toastManager","stateService","cursorService",function(e,t,n,r,o,i){var a=this;this.disableSend=!0;var l=function(){var e=document.getElementById("scrollable-container");$(e).scrollTop(e.scrollHeight)},s=t.$watch(function(){return n("gt-xs")},function(e){a.isLarge=e,a.placeholder=a.isLarge?"Enter your message here! Use Ctrl + Enter for a new line":"Enter your message here!"});e(function(){if(a.$el=document.getElementById("message-input-box"),a.isLarge){$(a.$el).focus();var e=$("#message-input-box").offset().top+26+48;e<$(window).height()&&r.showSimpleWithAction("Currently on "+o._state.pageName,1e3)}l()});var c=t.$on("$destroy",function(){a.$el=null,s(),c()});this.send=function(){if(this.$el.innerHTML){var e=$(this.$el).is(":focus"),n=this.checkYoutubeVideo(this.$el.innerHTML);o._state.socket.emit("message sent",n[0],o._state.user,o._state.page),t.quickMessageHandler({msg:n[0],user:o._state.user,youtube:n[1]}),this.$el.innerHTML="",e&&i.resetCursor(this.$el),$("#message-additional-button").webuiPopover("hide"),this.disableSend=!0}},this.increaseRows=function(){var e=document.createElement("br"),t=document.createTextNode(" ");i.insertAtCursor(function(n,r){var o=i.getRange(a.$el,r,!1,!0,!1).atEnd;r.deleteContents(),o&&r.insertNode(t),r.insertNode(e),
r.setStartAfter(e),r.setEndAfter(e),r.collapse(!1),n.removeAllRanges(),n.addRange(r)},function(){})},this.enterHandler=function(){this.isLarge?this.send():this.increaseRows()},this.ctrlEnterHandler=function(){this.isLarge?this.increaseRows():this.send()},this.keydownHandler=function(e){13===e.which&&(e.ctrlKey?this.ctrlEnterHandler():this.enterHandler(),e.preventDefault())},this.keyUpHandler=function(){a.disableSend=0===a.$el.innerHTML.length},this.checkYoutubeVideo=function(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,n=e.match(t);if(n&&11==n[2].length){var r='<iframe width="560" height="315" src="//www.youtube.com/embed/'+n[2]+'" frameborder="0" allowfullscreen></iframe>';return[r,!0]}return[e,!1]};var u="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";t.emoticonHandler=function(e){var t='<img class="'+e+' small" src="'+u+'">',n=$(t)[0];i.insertAtCursor(function(e,t){var r=document.createRange();t.insertNode(n),r.setStartAfter(n),r.setEndAfter(n),e.removeAllRanges(),e.addRange(r)},function(){a.$el.innerHTML+=n.outerHTML}),a.disableSend&&(a.disableSend=!1)},t.imageHandler=function(e){var n='<img src="'+e+'">';o._state.socket.emit("message sent",n,o._state.user,o._state.page),t.quickMessageHandler({msg:n,user:o._state.user}),$("#message-additional-button").webuiPopover("hide")}}]),app.directive("nemooMessageInput",function(){return{restrict:"E",scope:{quickMessageHandler:"&"},templateUrl:"/views/messageInput.ejs",controller:"MessageInputCtrl",controllerAs:"messageCtrl"}});var app=angular.module("App"),general=[{url:"/explore",title:"Explore",icon:"cloud"},{url:"/settings",title:"Settings",icon:"settings"}];app.controller("PanelCtrl",["$scope","$mdDialog","$mdSidenav","$mdMedia","$http","optimizationService","stateService",function(e,t,n,r,o,i,a){var l=this,s={callback:function(e){l.togglePanel(function(){t.show({controller:"DiscussionDialogCtrl",controllerAs:"dlgCtrl",templateUrl:"/views/createDiscussionDialog.ejs",parent:angular.element(document.body),locals:{user:a._state.user},targetEvent:e,clickOutsideToClose:!0})})},title:"Create Discussion",icon:"message"};a._state.loggedIn||general.pop(),general.unshift(s),this.general=general,this.hideTrending=!0,this.hideGeneral=!1,this.hideFavorites=!0,this.hideTopDiscussions=!0,a._state.loggedIn?e.$watch(function(){return a._state.user.favorites.length},function(e,t){l.favorites=a._state.user.favorites.map(function(e){return{title:e}})}):this.favorites=[],o.get("/trendingDiscussions").then(function(e){l.trending=e.data.trending}),o.get("/topDiscussions").then(function(e){l.topDiscussions=e.data.topDiscussions.reduce(function(e,t){var n={categoryLabel:t.category,toggleBoolean:!0,discussions:t.discussionNames};return e.push(n),e},[])}),this.unfocus=function(e,t){if(t.callback)t.callback(e);else{var n=t.url||"/page/"+t.title.toLowerCase().split(" ").join("-");l.togglePanel(function(){l.softRedirect(n)})}},this.togglePanel=function(e){var t=n("left"),o=r("gt-sm");o?e():t.close().then(e)},this.softRedirect=i.softRedirect}]),app.directive("nemooPanel",function(){return{restrict:"E",scope:!0,templateUrl:"/views/panel.ejs",controller:"PanelCtrl",controllerAs:"panelCtrl"}}),app.directive("nemooTopDiscussions",function(){return{restrict:"E",replace:!0,scope:{toggleBoolean:"=",discussions:"=",dynamicDiscussion:"=",fontStyling:"=",caretStyling:"=",itemStyling:"=",categoryLabel:"@",onClickHandler:"&"},templateUrl:"/views/topDiscussions.ejs",controller:["$scope",function(e){e.localClickHandler=function(t,n){e.onClickHandler({localEvent:t,localName:n})}}]}});var app=angular.module("App");app.controller("SearchBoxCtrl",["$http","$q","$mdSidenav","$mdMedia","optimizationService",function(e,t,n,r,o){var i=this;this.querySearch=function(n){var r=t.defer();return e.post("/searchDiscussion",{searchText:i.searchText}).then(function(e){r.resolve(e.data.discussions)}),r.promise},this.searchTextChange=function(e){},this.selectedItemChange=function(e){e&&this.togglePanel(function(){i.softRedirect("/page/"+e.name)})},this.togglePanel=function(e){var t=n("left"),o=r("gt-sm");o?e():t.close().then(e)},this.softRedirect=o.softRedirect}]),app.directive("nemooSearchBox",function(){return{restrict:"E",scope:!0,templateUrl:"/views/searchBox.ejs",controller:"SearchBoxCtrl",controllerAs:"searchBoxCtrl"}});var app=angular.module("App");app.controller("UserNavCtrl",["$mdSidenav","$mdMedia","optimizationService","stateService","$http",function(e,t,n,r,o){var i=this;this.softRedirect=n.softRedirect,this.isLoggedIn=r._state.loggedIn,this.unfocus=function(e,t){var n=t||function(){};i.togglePanel(function(){n(e,0)})},this.logout=function(){o.get("/logout").then(function(e){e.data.redirect&&n.refreshPage()})},this.togglePanel=function(t){e("left").close().then(t)}}]),app.directive("nemooUserNavPanel",function(){return{restrict:"E",templateUrl:"/views/userNavPanel.ejs",controller:"UserNavCtrl",controllerAs:"userNavCtrl"}});var app=angular.module("App");app.factory("animationService",function(){var e={};return e.show=function(){$("#loadingAnimation").css("display","block")},e.hide=function(){$("#loadingAnimation").css("display","none")},e.animateCss=function(e,t){var n="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";e.addClass("animated "+t).one(n,function(){e.removeClass("animated "+t)})},e});var app=angular.module("App");app.factory("cursorService",[function(){var e={};return e.resetCursor=function(e){var t=document.createRange();t.setStart(e,0),t.setEnd(e,0);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)},e.getRange=function(e,t,n,r,o){var i,a,l=t.cloneRange();return n&&(l.selectNodeContents(e),l.setEnd(t.startContainer,t.startOffset),i=o?""===l.toString().trim():""===l.toString()),r&&(l.selectNodeContents(e),l.setStart(t.endContainer,t.endOffset),a=o?""===l.toString().trim():""===l.toString()),{atStart:i,atEnd:a}},e.insertAtCursor=function(e,t){var n,r;return window.getSelection&&(n=window.getSelection(),n.getRangeAt&&n.rangeCount&&(r=window.getSelection().getRangeAt(0),cursorElement=r.commonAncestorContainer,"message-input-box"===cursorElement.id||"message-input-box"===cursorElement.parentElement.id))?void e(n,r):void t()},e}]);var app=angular.module("App");app.factory("optimizationService",["$window","$location","animationService",function(e,t,n){var r={},o=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"};return r.hardRedirect=function(t){n.show(),e.location.href=t},r.softRedirect=function(e){t.url(e),r.unbindAllEvents()},r.refreshPage=function(){n.show(),e.location.reload()},r.bindBodyBackDrop=function(){r.dropdownEl=$("#dropdown-custom-angular"),$("body").on("click.dropdownSelect",function(e){r.dropdownEl.hasClass("active")&&e.target!==r.dropdownEl[0]&&e.target!==r.dropdownEl[0].firstChild&&r.dropdownEl.removeClass("active")})},r.unbindBodyBackDrop=function(){r.dropdownEl&&(r.dropdownEl.removeClass("active"),r.dropdownEl=null,$("body").off("click.dropdownSelect"))},r.bindFocusHandler=function(){r.isFocused=!1,r.isAndroid="Android"===o(),r.additionalButtonEl=$("#message-additional-button"),$("#message-input-box").on({"focus.messageBox":function(){r.isFocused=!0},"blur.messageBox":function(){r.isAndroid&&r.additionalButtonEl.webuiPopover("hide"),r.isFocused=!1}})},r.attachUIPopover=function(e){r.additionalButtonEl.webuiPopover({animation:"pop",url:"#myContent",onShow:e,trigger:"manual",closeable:!0})},r.handleMenuClick=function(e){$("#myContent").is(":visible")?r.additionalButtonEl.webuiPopover("hide"):r.isFocused?r.additionalButtonEl.webuiPopover("show"):($("#message-input-box").focus(),r.isAndroid?$(window).one("resize.menuClick",function(){r.additionalButtonEl.webuiPopover("show")}):r.additionalButtonEl.webuiPopover("show")),e.preventDefault()},r.unbindFocusHandlerAndMenuClick=function(){r.additionalButtonEl&&($("#message-input-box").off("focus.messageBox blur.messageBox"),$(window).off("resize.menuClick"),r.isFocused=!1,r.additionalButtonEl.webuiPopover("destroy"),r.additionalButtonEl=null)},r.unbindAllEvents=function(){r.unbindBodyBackDrop(),r.unbindFocusHandlerAndMenuClick()},r}]);var app=angular.module("App");app.factory("stateService",[function(){var e={};return e.initialize=function(t,n,r){e._state={user:t,loggedIn:n,currentNumOnline:r,page:"",pageName:"",socket:io()}},e}]);var app=angular.module("App");app.factory("toastManager",["$mdToast",function(e){var t={};return t.showSimple=function(t,n){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n))},t.showSimpleWithAction=function(t,n,r){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n).action("CLOSE").highlightAction(!0).highlightClass("md-accent")).then(function(e){"ok"===e&&r&&r()})},t}]);