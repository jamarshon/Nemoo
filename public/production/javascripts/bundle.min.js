function checkAndUpdateFBURL(){"#_=_"==window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname))}function insertAtCursor(e,t){var n,o;return window.getSelection&&(n=window.getSelection(),n.getRangeAt&&n.rangeCount&&(o=window.getSelection().getRangeAt(0),cursorElement=o.commonAncestorContainer,"message-input-box"===cursorElement.id||"message-input-box"===cursorElement.parentElement.id))?void e(n,o):void t()}function getMobileOperatingSystem(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"}var app=angular.module("App",["ngRoute","ngMaterial","ngMessages","ngAnimate","ngSanitize"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$compileProvider",function(e,t,n,o){e.when("/page/:page",{templateUrl:function(e){return"/partials/"+e.page},controller:"DiscussionCtrl",controllerAs:"discussionCtrl"}).when("/",{templateUrl:"/views/home.ejs"}),t.html5Mode({enabled:!0,requireBase:!1}),o.debugInfoEnabled(!1),checkAndUpdateFBURL();var i=n.extendPalette("indigo",{contrastDefaultColor:"light",contrastDarkColors:["50"],50:"ffffff"});n.definePalette("custom",i),n.theme("default").primaryPalette("custom",{default:"500","hue-1":"50"}).accentPalette("amber")}]),app.run(["$templateCache",function(e){e.put("ngDropdowns/templates/dropdownSelect.html",['<div id="dropdown-custom-angular" ng-mousedown="toggleDropDown($event)" ng-class="{\'disabled\': dropdownDisabled}" class="wrap-dd-select" tabindex="0">','<span ng-mousedown="toggleDropDown($event)" class="selected">{{dropdownModel[labelField]}}</span>','<ul class="dropdown">','<li ng-repeat="item in dropdownSelect"',' class="dropdown-item"',' dropdown-select-item="item"',' dropdown-item-label="labelField">',"</li>","</ul>","</div>"].join("")),e.put("ngDropdowns/templates/dropdownSelectItem.html",["<li ng-class=\"{divider: (dropdownSelectItem.divider && !dropdownSelectItem[dropdownItemLabel]), 'divider-label': (dropdownSelectItem.divider && dropdownSelectItem[dropdownItemLabel])}\">",'<a href="" class="dropdown-item"',' ng-if="!dropdownSelectItem.divider"',' ng-href="{{dropdownSelectItem.href}}"',' ng-mousedown="selectItem($event)">',"{{dropdownSelectItem[dropdownItemLabel]}}","</a>",'<span ng-if="dropdownSelectItem.divider">',"{{dropdownSelectItem[dropdownItemLabel]}}","</span>","</li>"].join(""))}]);var app=angular.module("App");app.controller("AuthenticationCtrl",["$http","optimizationService",function(e,t){var n=this;this.data={email:"",password:"",password2:""},this.submit=function(o){e.post(o,n.data).success(function(e){e.redirect?t.hardRedirect(e.redirect):n.message=e.message})}}]),app.directive("nemooLogin",function(){return{restrict:"E",templateUrl:"/views/login.ejs",controller:"AuthenticationCtrl",controllerAs:"loginCtrl"}}),app.directive("nemooSignUp",function(){return{restrict:"E",templateUrl:"/views/signup.ejs",controller:"AuthenticationCtrl",controllerAs:"signUpCtrl"}});var app=angular.module("App"),options=["Advice","Animals","Automotive","Books","Business","Career","Celebrity","Debate","Entertainment","Environment","Family","Fashion","Finance","Food","Gaming","Health","Hobbies","Humor","Lifestyle","Movies","Music","News","Religion","Science","Sports","Technology","Television","Travel","Weather"];app.controller("DiscussionDialogCtrl",["$mdDialog","$http","$scope","user","toastManager","optimizationService",function(e,t,n,o,i,r){var a=this;this.options=options.map(function(e){return{text:e,val:e.toLowerCase()}}),this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.data={category:"",name:"",description:"",user:o},this.submit=function(e){var n=a.cleanData(a.data);t.post(e,n).success(function(e){e.redirect?(r.softRedirect(e.redirect),a.cancel(),i.showSimple("Successfully create discussion!!",3e3)):a.message=e.message})},this.cleanData=function(e){return{category:e.category,name:e.name.toLowerCase().split(" ").join("-"),description:e.description,user:e.user}}}]);var app=angular.module("App"),MAX_QUEUE_LENGTH=25;app.controller("DiscussionCtrl",["$mdMedia","$routeParams","$rootScope","$timeout","$scope","$templateCache","stateService",function(e,t,n,o,i,r,a){var s=this,l=t.page;console.log(l),r.remove("/partials/"+l),this.init=function(e,t){a._state.page=l,a._state.pageName=e,this.prerenderedLen=t,this.data=[],a._state.socket.on(a._state.page+" message received",function(e,t){var n=s.data.length,o={displayName:t.displayName,profilePic:t.profilePic,backgroundColor:t.backgroundColor,created:t.created,message:e};0===s.prerenderedLen?s.data.shift():0===n?s.lastPrerenderedEl.append($("<md-divider md-inset></md-divider>")):s.prerenderedLen+n>=MAX_QUEUE_LENGTH&&(s.$el.find("md-list-item").first().remove(),s.prerenderedLen--),s.data.push(o),i.$apply()})},o(function(){s.$el=$("#scrollable-container-list"),s.lastPrerenderedEl=s.$el.find("md-list-item").last(),s.lastPrerenderedEl.find("md-divider").remove()});var d=n.$on("$routeChangeSuccess",function(){s.$el=null,s.lastPrerenderedEl=null,s.data=null,a._state.socket.removeAllListeners(a._state.page+" message received"),d()})}]),app.animation(".animate-message",[function(){return{enter:function(e){$(e).addClass("animated bounce"),scrollBottom()}}}]),function(e,t,n,o,i,r,a){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,r=t.createElement(n),a=t.getElementsByTagName(n)[0],r.async=1,r.src=o,a.parentNode.insertBefore(r,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-84261333-1","auto"),ga("send","pageview");var app=angular.module("App");app.controller("HeaderCtrl",["$scope","$mdSidenav","$mdMedia","$mdDialog","optimizationService","stateService",function(e,t,n,o,i,r){var a=this;e.$watch(function(){return n("gt-sm")},function(e){a.open=e});this.togglePanel=function(){var e=t("left"),o=n("gt-sm");o?a.open=!a.open:(e.isOpen()||($("#message-input-box").blur(),window.getSelection().removeAllRanges()),e.toggle())},this.hardRedirect=i.hardRedirect,this.softRedirect=i.softRedirect,this.state=r._state,this.showTabDialog=function(e,t){o.show({controller:["$mdDialog","optimizationService",function(e,n){this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.redirect=n.hardRedirect,this.selected=t}],controllerAs:"dlgCtrl",templateUrl:"/views/loginDialog.ejs",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.directive("nemooHeader",function(){return{restrict:"E",templateUrl:"/views/header.ejs",controller:"HeaderCtrl",controllerAs:"header"}});var app=angular.module("App");app.controller("MainCtrl",["stateService","$http",function(e,t){this.init=e.initialize,t.post("/setTimezone",{offset:(new Date).getTimezoneOffset()}),emojify.setConfig({mode:"sprite"})}]);var app=angular.module("App");app.controller("AdditionalOptionsDropdownCtrl",["$scope",function(e){e.ddSelectOptions=[{text:"Emoticon (People)",pageKey:"people"},{text:"Emoticon (Nature)",pageKey:"nature"},{text:"Emoticon (Object)",pageKey:"object"},{text:"Emoticon (Places)",pageKey:"places"},{text:"Emoticon (Symbol)",pageKey:"symbol"}],e.ddSelectSelected={text:"Emoticon (People)",pageKey:"people"},e.selectHandler=function(t){e.$parent.handlePageChange(t)}}]),app.directive("nemooAdditionalOptionsDropdown",function(){return{restrict:"E",scope:{},templateUrl:"/views/additionalOptionsDropdown.ejs",controller:"AdditionalOptionsDropdownCtrl"}});var app=angular.module("App");app.directive("dropdownSelect",[function(){return{restrict:"A",replace:!0,scope:{dropdownSelect:"=",dropdownModel:"=",dropdownItemLabel:"@",dropdownOnchange:"&",dropdownDisabled:"="},controller:["$scope","$timeout",function(e,t){var n=this;e.labelField=e.dropdownItemLabel||"text",this.select=function(t){angular.equals(t,e.dropdownModel)||(e.dropdownModel=t),e.dropdownOnchange({selected:t}),n.$el.removeClass("active")},e.toggleDropDown=function(t){t.stopPropagation(),t.preventDefault(),e.dropdownDisabled||n.$el.toggleClass("active")},t(function(){n.$el=angular.element(document.getElementById("dropdown-custom-angular"))}),e.$on("$destroy",function(){n.$el=null})}],templateUrl:"ngDropdowns/templates/dropdownSelect.html"}}]),app.directive("dropdownSelectItem",[function(){return{require:"^dropdownSelect",replace:!0,scope:{dropdownItemLabel:"=",dropdownSelectItem:"="},link:function(e,t,n,o){e.selectItem=function(t){t.stopPropagation(),t.preventDefault(),e.dropdownSelectItem.href||o.select(e.dropdownSelectItem)}},templateUrl:"ngDropdowns/templates/dropdownSelectItem.html"}}]);var app=angular.module("App");app.controller("MessageAdditionalOptionsCtrl",["$scope","$rootScope","$timeout","$templateCache","$mdMedia","optimizationService",function(e,t,n,o,i,r){var a=this;this.pageKey="people";var s=e.$watch(function(){return i("gt-xs")},function(e){a.isLarge=e});this.onShowHandler=function(e){if(!a.isLarge){var t=$(window).width(),n=(t-278)/2,o=a.$el.offset().left+a.$el.width()/2-n;e.css("left",n),e.find(".webui-arrow").css("left",o)}},this.addEmoji=function(t){var n=$(t.target),o="SPAN"===n.prop("tagName")?n:n.find("span");e.$parent.emoticonHandler(o),t.preventDefault()},e.handlePageChange=function(e){a.pageKey=e.pageKey},n(function(){a.$el=$("#message-additional-button > .material-icons"),r.bindBodyBackDrop(),r.bindFocusHandler(),r.attachUIPopover(a.onShowHandler),a.showMenu=r.handleMenuClick});var l=t.$on("$routeChangeSuccess",function(){a.$el=null,s(),l()})}]),app.directive("nemooMessageAdditionalOptions",function(){return{restrict:"E",scope:{},templateUrl:"/views/messageAdditionalOptions.ejs",controller:"MessageAdditionalOptionsCtrl",controllerAs:"messageAddCtrl"}});var app=angular.module("App"),scrollBottom=function(){var e=document.getElementById("scrollable-container");$(e).scrollTop(e.scrollHeight)};app.controller("MessageInputCtrl",["$timeout","$scope","$rootScope","$mdMedia","toastManager","stateService",function(e,t,n,o,i,r){var a=this;this.disableSend=!0;var s=t.$watch(function(){return o("gt-xs")},function(e){a.isLarge=e,a.placeholder=a.isLarge?"Enter your message here! Use Ctrl + Enter for a new line":"Enter your message here!"});e(function(){if(a.$el=document.getElementById("message-input-box"),a.isLarge){$(a.$el).focus();var e=$("#message-input-box").offset().top+26+48;e<$(window).height()&&i.showSimpleWithAction("Currently on "+r._state.pageName,1e3)}scrollBottom()});var l=n.$on("$routeChangeSuccess",function(){a.$el=null,s(),l()});this.send=function(){this.$el.innerHTML&&(r._state.socket.emit("message sent",this.$el.innerHTML,r._state.user,r._state.page),this.$el.innerHTML="",this.resetCursor(),$("#message-additional-button").webuiPopover("hide"),this.disableSend=!0)},this.resetCursor=function(){var e=document.createRange();e.setStart(this.$el,0),e.setEnd(this.$el,0);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},this.increaseRows=function(){var e=document.createElement("br"),t=document.createTextNode(" ");insertAtCursor(function(n,o){var i=a.getRange(o,!1,!0,!1).atEnd;o.deleteContents(),i&&o.insertNode(t),o.insertNode(e),o.setStartAfter(e),o.setEndAfter(e),o.collapse(!1),n.removeAllRanges(),n.addRange(o)},function(){})},this.enterHandler=function(){this.isLarge?this.send():this.increaseRows()},this.ctrlEnterHandler=function(){this.isLarge?this.increaseRows():this.send()},this.checkForDisableSend=function(e,t){var n=$(a.$el).text().trim();e?insertAtCursor(function(e,t){var o=a.getRange(t,!0,!0,!0);(o.atStart&&o.atEnd||1===n.length)&&(a.disableSend=!0)},function(){}):0===n.length&&t?a.disableSend=!0:a.disableSend&&(a.disableSend=!1)},this.throttledKeyPressHandler=_.throttle(this.checkForDisableSend,500);var d=/^[a-z0-9!"#$%&'()*+,.\/:;<=>?@\[\] ^_`{|}~-]*$/i;this.keydownHandler=function(e){var t=e.which,n=String.fromCharCode(t);if(13===t)e.ctrlKey?this.ctrlEnterHandler():this.enterHandler(),e.preventDefault();else if(8==t||46===t)this.checkForDisableSend(!0,!1);else if(d.test(n)){var o=0===t||32===t;this.throttledKeyPressHandler(!1,o)}};var c="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";t.emoticonHandler=function(e){var t='<img class="'+e.attr("class")+' small" src="'+c+'">',n=$(t)[0];insertAtCursor(function(e,t){var o=document.createRange();t.insertNode(n),o.setStartAfter(n),o.setEndAfter(n),e.removeAllRanges(),e.addRange(o)},function(){a.$el.innerHTML+=n.outerHTML}),a.disableSend&&(a.disableSend=!1)},this.getRange=function(e,t,n,o){var i,r,s=e.cloneRange();return t&&(s.selectNodeContents(a.$el),s.setEnd(e.startContainer,e.startOffset),i=o?""===s.toString().trim():""===s.toString()),n&&(s.selectNodeContents(a.$el),s.setStart(e.endContainer,e.endOffset),r=o?""===s.toString().trim():""===s.toString()),{atStart:i,atEnd:r}}}]),app.directive("nemooMessageInput",function(){return{restrict:"E",templateUrl:"/views/messageInput.ejs",controller:"MessageInputCtrl",controllerAs:"messageCtrl"}});var app=angular.module("App"),general=[{url:"/explore",title:"Explore",icon:"cloud"},{url:"/settings",title:"Settings",icon:"settings"}];app.controller("PanelCtrl",["$scope","$mdDialog","$mdSidenav","$mdMedia","$http","optimizationService","stateService",function(e,t,n,o,i,r,a){var s=this,l={callback:function(e){s.togglePanel(function(){t.show({controller:"DiscussionDialogCtrl",controllerAs:"dlgCtrl",templateUrl:"/views/createDiscussionDialog.ejs",parent:angular.element(document.body),locals:{user:a._state.user},targetEvent:e,clickOutsideToClose:!0})})},title:"Create Discussion",icon:"message"};a._state.loggedIn||general.pop(),general.unshift(l),this.general=general,this.hideTrending=!0,this.hideGeneral=!1,i.get("/trendingDiscussions").then(function(e){s.trending=e.data.trending}),s.topDiscussions=[],i.get("/topDiscussions").then(function(e){e.data.topDiscussions.forEach(function(e){var t={categoryLabel:e.category,toggleBoolean:!0,discussions:e.discussionNames};s.topDiscussions.push(t)})}),this.unfocus=function(e,t){if(t.callback)t.callback(e);else{var n=t.url||"/page/"+t.title.toLowerCase().split(" ").join("-");s.togglePanel(function(){s.softRedirect(n)})}$(e.target).blur()},this.togglePanel=function(e){var t=n("left"),i=o("gt-sm");i?e():t.close().then(e)},this.softRedirect=r.softRedirect}]),app.directive("nemooPanel",function(){return{restrict:"E",templateUrl:"/views/panel.ejs",controller:"PanelCtrl",controllerAs:"panelCtrl"}}),app.directive("nemooTopDiscussions",function(){return{restrict:"E",replace:!0,scope:{toggleBoolean:"=",discussions:"=",categoryLabel:"@",onClickHandler:"&"},templateUrl:"/views/topDiscussions.ejs",controller:["$scope",function(e){e.localClickHandler=function(t,n){e.onClickHandler({localEvent:t,localName:n})}}]}});var app=angular.module("App");app.controller("SearchBoxCtrl",["$http","$q","$mdSidenav","$mdMedia","optimizationService",function(e,t,n,o,i){var r=this;this.querySearch=function(n){var o=t.defer();return e.post("/searchDiscussion",{searchText:r.searchText}).then(function(e){o.resolve(e.data.discussions)}),o.promise},this.searchTextChange=function(e){},this.selectedItemChange=function(e){e&&this.togglePanel(function(){r.softRedirect("/page/"+e.name)})},this.togglePanel=function(e){var t=n("left"),i=o("gt-sm");i?e():t.close().then(e)},this.softRedirect=i.softRedirect}]),app.directive("nemooSearchBox",function(){return{restrict:"E",templateUrl:"/views/searchBox.ejs",controller:"SearchBoxCtrl",controllerAs:"searchBoxCtrl"}});var app=angular.module("App");app.controller("UserNavCtrl",["$mdSidenav","$mdMedia","optimizationService","stateService",function(e,t,n,o){var i=this;this.hardRedirect=n.hardRedirect,this.softRedirect=n.softRedirect,this.isLoggedIn=o._state.isLoggedIn,this.unfocus=function(e,t){var n=t||function(){};i.togglePanel(function(){$(e.target).blur(),n(e,0)})},this.togglePanel=function(t){e("left").close().then(t)}}]),app.directive("nemooUserNavPanel",function(){return{restrict:"E",templateUrl:"/views/userNavPanel.ejs",controller:"UserNavCtrl",controllerAs:"userNavCtrl"}});var app=angular.module("App");app.factory("loaderAnimation",function(){var e={};return e.show=function(){$("#loadingAnimation").css("display","block")},e.hide=function(){$("#loadingAnimation").css("display","none")},e});var app=angular.module("App");app.factory("optimizationService",["$window","$location","loaderAnimation",function(e,t,n){var o={};return o.hardRedirect=function(t){n.show(),e.location.href=t},o.softRedirect=function(e){t.url(e),o.unbindAllEvents()},o.bindBodyBackDrop=function(){o.dropdownEl=$("#dropdown-custom-angular"),$("body").on("click.dropdownSelect",function(e){o.dropdownEl.hasClass("active")&&e.target!==o.dropdownEl[0]&&e.target!==o.dropdownEl[0].firstChild&&o.dropdownEl.removeClass("active")})},o.unbindBodyBackDrop=function(){o.dropdownEl&&(o.dropdownEl.removeClass("active"),o.dropdownEl=null,$("body").off("click.dropdownSelect"))},o.bindFocusHandler=function(){o.isFocused=!1,o.isAndroid="Android"===getMobileOperatingSystem(),o.additionalButtonEl=$("#message-additional-button"),$("#message-input-box").on({"focus.messageBox":function(){o.isFocused=!0},"blur.messageBox":function(){o.isAndroid&&o.additionalButtonEl.webuiPopover("hide"),o.isFocused=!1}})},o.attachUIPopover=function(e){o.additionalButtonEl.webuiPopover({animation:"pop",url:"#myContent",onShow:e,trigger:"manual",closeable:!0})},o.handleMenuClick=function(e){o.isFocused?o.additionalButtonEl.webuiPopover("show"):($("#message-input-box").focus(),o.isAndroid?$(window).one("resize.menuClick",function(){o.additionalButtonEl.webuiPopover("show")}):o.additionalButtonEl.webuiPopover("show")),e.preventDefault()},o.unbindFocusHandlerAndMenuClick=function(){o.additionalButtonEl&&($("#message-input-box").off("focus.messageBox blur.messageBox"),$(window).off("resize.menuClick"),o.isFocused=!1,o.additionalButtonEl.webuiPopover("destroy"),o.additionalButtonEl=null)},o.unbindAllEvents=function(){o.unbindBodyBackDrop(),o.unbindFocusHandlerAndMenuClick()},o}]);var app=angular.module("App");app.factory("stateService",[function(){var e={};return e.initialize=function(t,n,o){e._state={user:t,loggedIn:n,currentNumOnline:o,page:"",pageName:"",socket:io()}},e}]);var app=angular.module("App");app.factory("toastManager",["$mdToast",function(e){var t={};return t.showSimple=function(t,n){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n))},t.showSimpleWithAction=function(t,n,o){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n).action("CLOSE").highlightAction(!0).highlightClass("md-accent")).then(function(e){"ok"===e&&o&&o()})},t}]);