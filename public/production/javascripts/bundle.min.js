function checkAndUpdateFBURL(){"#_=_"==window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname))}function getMobileOperatingSystem(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"}var app=angular.module("App",["ngRoute","ngMaterial","ngMessages","ngAnimate","ngSanitize","ngDropdowns"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$compileProvider",function(e,t,n,o){e.when("/page/:page",{templateUrl:function(e){return"/partials/"+e.page},controller:"DiscussionCtrl",controllerAs:"discussionCtrl"}).when("/",{templateUrl:"/views/home.ejs"}),t.html5Mode({enabled:!0,requireBase:!1}),checkAndUpdateFBURL();var i=n.extendPalette("indigo",{contrastDefaultColor:"light",contrastDarkColors:["50"],50:"ffffff"});n.definePalette("custom",i),n.theme("default").primaryPalette("custom",{default:"500","hue-1":"50"}).accentPalette("amber")}]);var app=angular.module("App");app.controller("AdditionalOptionsDropdownCtrl",["$scope",function(e){e.ddSelectOptions=[{text:"Emoticon (People)",pageKey:"people"},{text:"Emoticon (Nature)",pageKey:"nature"},{text:"Emoticon (Object)",pageKey:"object"},{text:"Emoticon (Places)",pageKey:"places"},{text:"Emoticon (Symbol)",pageKey:"symbol"}],e.ddSelectSelected={text:"Emoticon (People)",pageKey:"people"},e.selectHandler=function(t){e.$parent.handlePageChange(t)}}]),app.directive("nemooAdditionalOptionsDropdown",function(){return{restrict:"E",scope:{},templateUrl:"/views/additionalOptionsDropdown.ejs",controller:"AdditionalOptionsDropdownCtrl"}});var app=angular.module("App");app.controller("AuthenticationCtrl",["$http","optimizationService",function(e,t){var n=this;this.data={email:"",password:"",password2:""},this.submit=function(o){e.post(o,n.data).success(function(e){e.redirect?t.hardRedirect(e.redirect):n.message=e.message})}}]),app.directive("nemooLogin",function(){return{restrict:"E",templateUrl:"/views/login.ejs",controller:"AuthenticationCtrl",controllerAs:"loginCtrl"}}),app.directive("nemooSignUp",function(){return{restrict:"E",templateUrl:"/views/signup.ejs",controller:"AuthenticationCtrl",controllerAs:"signUpCtrl"}});var app=angular.module("App"),MAX_QUEUE_LENGTH=25;app.controller("DiscussionCtrl",["$mdMedia","$routeParams","$timeout","$scope","$templateCache",function(e,t,n,o,i){var a=this,r=t.page;console.log(r),i.remove("/partials/"+r),this.init=function(e,t){e.page=r,this.main=e,this.pageName=t,this.main.socket.on(this.main.page+" message received",function(e,t){var n={displayName:t.displayName,profilePic:t.profilePic,backgroundColor:t.backgroundColor,created:t.created,message:e};a.data.length>MAX_QUEUE_LENGTH&&a.data.shift(),a.data.push(n),o.$apply()})}}]),app.animation(".animate-message",[function(){return{enter:function(e){$(e).addClass("animated bounce"),scrollBottom()}}}]);var app=angular.module("App"),options=["Advice","Animals","Automotive","Books","Business","Career","Celebrity","Debate","Entertainment","Environment","Family","Fashion","Finance","Food","Gaming","Health","Hobbies","Humor","Lifestyle","Movies","Music","News","Religion","Science","Sports","Technology","Television","Travel","Weather"];app.controller("DiscussionDialogCtrl",["$mdDialog","$http","$scope","user","toastManager","optimizationService",function(e,t,n,o,i,a){var r=this;this.options=options.map(function(e){return{text:e,val:e.toLowerCase()}}),this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.data={category:"",name:"",description:"",user:o},this.submit=function(e,n){var o=r.cleanData(r.data);t.post(e,o).success(function(e){e.redirect?(a.softRedirect(e.redirect),r.cancel(),i.showSimple("Successfully create discussion!!",3e3)):r.message=e.message})},this.cleanData=function(e){return{category:e.category,name:e.name.toLowerCase().split(" ").join("-"),description:e.description,user:e.user}}}]),function(e,t,n,o,i,a,r){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(n),r=t.getElementsByTagName(n)[0],a.async=1,a.src=o,r.parentNode.insertBefore(a,r)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-84261333-1","auto"),ga("send","pageview");var app=angular.module("App");app.controller("HeaderCtrl",["$scope","$mdSidenav","$mdMedia","$mdDialog","optimizationService",function(e,t,n,o,i){var a=this;e.$watch(function(){return n("gt-sm")},function(e){a.open=e}),this.togglePanel=function(){var e=t("left"),o=n("gt-sm");o?a.open=!a.open:e.toggle()},this.hardRedirect=i.hardRedirect,this.softRedirect=i.softRedirect,this.showTabDialog=function(e,t){o.show({controller:["$mdDialog","optimizationService",function(e,n){this.hide=function(){e.hide()},this.cancel=function(){e.cancel()},this.redirect=n.hardRedirect,this.selected=t}],controllerAs:"dlgCtrl",templateUrl:"/views/loginDialog.ejs",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.directive("nemooHeader",function(){return{restrict:"E",templateUrl:"/views/header.ejs",controller:"HeaderCtrl",controllerAs:"header"}});var app=angular.module("App");app.factory("loaderAnimation",function(){var e={};return e.show=function(){$("#loadingAnimation").css("display","block")},e.hide=function(){$("#loadingAnimation").css("display","none")},e});var app=angular.module("App");app.controller("MainCtrl",[function(){this.socket=io(),emojify.setConfig({mode:"sprite"})}]);var app=angular.module("App");app.controller("MessageAdditionalOptionsCtrl",["$scope","$timeout","$templateCache","$mdMedia","optimizationService",function(e,t,n,o,i){var a=this;n.remove("/views/messageAdditionalOptions.ejs"),this.pageKey="people",this.isLarge=o("gt-xs");var r=$("#message-additional-button > .material-icons"),s=$("#message-additional-button"),l=this.isLarge?function(){}:function(e){var t=$(window).width(),n=(t-278)/2,o=r.offset().left+r.width()/2-n;e.css("left",n),e.find(".webui-arrow").css("left",o)};s.webuiPopover({animation:"pop",url:"#myContent",onShow:l,trigger:"manual",closeable:!0}),this.addEmoji=function(t){var n=$(t.target),o="SPAN"===n.prop("tagName")?n:n.find("span");e.$parent.emoticonHandler(o.attr("title")),t.preventDefault()},e.handlePageChange=function(e){a.pageKey=e.pageKey},t(function(){i.bindBodyBackDrop(),i.bindFocusHandler(),a.showMenu=i.handleMenuClick})}]),app.directive("nemooMessageAdditionalOptions",function(){return{restrict:"E",scope:{},templateUrl:"/views/messageAdditionalOptions.ejs",controller:"MessageAdditionalOptionsCtrl",controllerAs:"messageAddCtrl"}});var app=angular.module("App"),scrollBottom=function(){var e=document.getElementById("scrollable-container");$(e).scrollTop(e.scrollHeight)};app.controller("MessageInputCtrl",["$timeout","$scope","$mdMedia","toastManager",function(e,t,n,o){var i=this;this.message="",this.rows=1,this.isLarge=n("gt-xs"),e(function(){if(i.isLarge){$("#message-input-box").focus();var e=$("#message-input-box").offset().top+26+48;e<$(window).height()&&o.showSimpleWithAction("Currently on "+i.main.page,1e3)}scrollBottom()}),this.send=function(){if(this.message){var e=emojify.replace(this.message);this.message=e,this.message=this.message.replace(/(?:\r\n|\r|\n)/g,"<br />"),this.main.socket.emit("message sent",this.message,this.main.user,this.main.page),this.message="",this.rows=1,$("#message-additional-button").webuiPopover("hide")}},this.init=function(e){this.main=e},this.increaseRows=function(){this.rows++,this.message+="\n"},this.enterHandler=this.isLarge?this.send:this.increaseRows,this.ctrlEnterHandler=this.isLarge?this.increaseRows:this.send,t.emoticonHandler=function(e){i.message+=" "+e+" "},t.$watch(function(){return $("#message-input-box").height()},function(e,t){if(e){var n=Math.min(30*i.rows,e);$("#message-input-box").attr("rows",i.rows).height(n)}})}]),app.directive("customKeyPress",function(){return function(e,t,n){t.bind("keydown keypress",function(t){if(13===t.which){var o=t.ctrlKey?"onCtrlEnterPressed":"onEnterPressed";e.$apply(function(){e.$eval(n[o])}),t.preventDefault()}})}}),app.directive("nemooMessageInput",function(){return{restrict:"E",templateUrl:"/views/messageInput.ejs",controller:"MessageInputCtrl",controllerAs:"messageCtrl"}});var app=angular.module("App");app.factory("optimizationService",["$window","$location","loaderAnimation",function(e,t,n){var o={};return o.hardRedirect=function(t){n.show(),e.location.href=t},o.softRedirect=function(e){t.url(e),o.unbindAllEvents()},o.bindBodyBackDrop=function(){o.dropdownEl=$("#dropdown-custom-angular"),$("body").on("click.dropdownSelect",function(e){o.dropdownEl.hasClass("active")&&e.target!==o.dropdownEl[0]&&e.target!==o.dropdownEl[0].firstChild&&o.dropdownEl.removeClass("active")})},o.unbindBodyBackDrop=function(){o.dropdownEl&&(o.dropdownEl.removeClass("active"),o.dropdownEl=null,$("body").off("click.dropdownSelect"))},o.bindFocusHandler=function(){o.isFocused=!1,o.isAndroid="Android"===getMobileOperatingSystem(),o.additionalButtonEl=$("#message-additional-button"),$("#message-input-box").on({"focus.messageBox":function(){console.log("hi"),o.isFocused=!0},"blur.messageBox":function(){o.isAndroid&&o.additionalButtonEl.webuiPopover("hide"),o.isFocused=!1}})},o.handleMenuClick=function(e){o.isFocused?o.additionalButtonEl.webuiPopover("show"):($("#message-input-box").focus(),o.isAndroid?$(window).one("resize.menuClick",function(){o.additionalButtonEl.webuiPopover("show")}):o.additionalButtonEl.webuiPopover("show")),e.preventDefault()},o.unbindFocusHandlerAndMenuClick=function(){o.additionalButtonEl&&($("#message-input-box").off("focus.messageBox blur.messageBox"),$(window).off("resize.menuClick"),o.isFocused=!1,o.additionalButtonEl.webuiPopover("destroy"),o.additionalButtonEl=null)},o.unbindAllEvents=function(){o.unbindBodyBackDrop(),o.unbindFocusHandlerAndMenuClick()},o}]);var app=angular.module("App"),general=[{url:"/explore",title:"Explore",icon:"cloud"},{url:"/settings",title:"Settings",icon:"settings"}];app.controller("PanelCtrl",["$mdDialog","$mdSidenav","$mdMedia","$http","optimizationService",function(e,t,n,o,i){var a=this,r={callback:function(t){a.togglePanel(function(){e.show({controller:"DiscussionDialogCtrl",controllerAs:"dlgCtrl",templateUrl:"/views/createDiscussionDialog.ejs",parent:angular.element(document.body),locals:{user:a.main.user},targetEvent:t,clickOutsideToClose:!0})})},title:"Create Discussion",icon:"message"};general.unshift(r),this.general=general,o.get("/trendingDiscussions").then(function(e){a.trending=e.data.discussions.map(function(e){return{title:e}})}),this.init=function(e){a.main=e},this.unfocus=function(e,t){if(t.callback)t.callback(e);else{var n=t.url||"/page/"+t.title.toLowerCase().split(" ").join("-");a.togglePanel(function(){a.softRedirect(n)})}$(e.target).blur()},this.togglePanel=function(e){var o=t("left"),i=n("gt-sm");i?e():o.close().then(e)},this.removeSettings=function(e){return function(t){return"Settings"!==t.title||e}},this.softRedirect=i.softRedirect}]),app.directive("nemooPanel",function(){return{restrict:"E",templateUrl:"/views/panel.ejs",controller:"PanelCtrl",controllerAs:"panelCtrl"}});var app=angular.module("App");app.controller("SearchBoxCtrl",["$http","$q","$mdSidenav","$mdMedia","optimizationService",function(e,t,n,o,i){var a=this;this.querySearch=function(n){var o=t.defer();return e.post("/searchDiscussion",{searchText:a.searchText}).then(function(e){o.resolve(e.data.discussions)}),o.promise},this.searchTextChange=function(e){},this.selectedItemChange=function(e){e&&this.togglePanel(function(){a.softRedirect("/page/"+e.name)})},this.togglePanel=function(e){var t=n("left"),i=o("gt-sm");i?e():t.close().then(e)},this.softRedirect=i.softRedirect}]),app.directive("nemooSearchBox",function(){return{restrict:"E",templateUrl:"/views/searchBox.ejs",controller:"SearchBoxCtrl",controllerAs:"searchBoxCtrl"}});var app=angular.module("App");app.factory("toastManager",["$mdToast",function(e){var t={};return t.showSimple=function(t,n){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n))},t.showSimpleWithAction=function(t,n,o){e.show(e.simple().textContent(t).position("bottom right").hideDelay(n).action("CLOSE").highlightAction(!0).highlightClass("md-accent")).then(function(e){"ok"===e&&o&&o()})},t}]);var app=angular.module("App");app.controller("UserNavCtrl",["$mdSidenav","$mdMedia","optimizationService",function(e,t,n){var o=this;this.hardRedirect=n.hardRedirect,this.softRedirect=n.softRedirect,this.unfocus=function(e,t){var n=t||function(){};o.togglePanel(function(){$(e.target).blur(),n(e,0)})},this.togglePanel=function(t){e("left").close().then(t)}}]),app.directive("nemooUserNavPanel",function(){return{restrict:"E",templateUrl:"/views/userNavPanel.ejs",controller:"UserNavCtrl",controllerAs:"userNavCtrl"}});